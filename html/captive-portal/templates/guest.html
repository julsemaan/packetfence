[% title = i18n("PacketFence Registration System") %]
[% INCLUDE header.html
    body_attributes = 'onload="$(\'firstfield\').focus();"';
%]

        <div class="underlined" style="text-align:center">
          <div style="display:inline-block;width:353px;">
            <h3 style="float:left;display:inline-block">Register using : </h4>
            <form id="guest-signup-method">
              <input class="signup-mode" checked="checked" type="radio" name="signup-mode" value="email-mode">E-mail<br>
              <input class="signup-mode" type="radio" name="signup-mode" value="sms-mode">SMS<br>
            </form>
          </div>
        </div>
        <hr/>

        <div id="about" class="underlined">
          <img src="/content/images/registration.png" alt="Registration" />
          <h1>[% i18n("Guest Registration") %]</h1>
          <p>[% i18n("guest network disclaimer") %]</p>
          <hr/>
        </div>

        [%# Error %]
        [% IF txt_validation_error.defined %]<div class="error"><p>[% txt_validation_error %]</p></div>[% END %]
        <form method="post" action="[% post_uri %]">
          <input type="hidden" name="destination_url" value="[% destination_url %]" />

        [% skipFields = {firstname => undef, lastname => undef} %]
        [% FOREACH field IN mandatory_fields %]
        [%- NEXT IF skipFields.exists(field) -%]
          <div class="input" id="field-[% field %]">
            [% IF (field == 'mobileprovider') %]
              <span>[% i18n("Phone Provider") %]</span>
              <select name="mobileprovider">
                <option value="">[% i18n("Select your provider") %]</option>
                    [% FOREACH carrier IN sms_carriers %]<option value="[% carrier.id %]"[% IF mobileprovider == carrier.id %] selected[% END %]>[% carrier.name %]</option>
                    [% END %]
              </select>
              [% IF sms_guest_allowed %]
                <em>Required to receive your access code by SMS</em>
              [% END %]
            [% ELSIF (field == 'sponsor_email') %]
              <span>[% i18n("Sponsor's email") %]</span>
              <input class="field" name="[% field %]" type="text" value="[% sponsor_email | html %]" /><br/>
              [% IF sponsored_guest_allowed %]
                <em>Required for sponsored network access</em>
              [% END %]
            [% ELSIF (field == 'email') %]
              <span>[% i18n("$field") %]</span>
              <input class="field" name="[% field %]" type="text" value="[% email | html %]" /><br/>
              [% IF email_guest_allowed %]
                <em>Required for email network access</em>
              [% END %]
            [% ELSIF ( field == 'phone') %]
              <span>[% i18n("$field") %]</span>
              <input class="field" name="[% field %]" type="text" value="[% phone | html %]" /><br/>
              [% IF sms_guest_allowed %]
                <em>Required for SMS network access</em>
              [% END %]
            [% ELSE %]
              <span>[% i18n("$field") %]</span>
              <input class="field" name="[% field %]" type="text" value="[% c.stash.$field | html %]" /><br/>
            [% END %]
          </div>
          [% END %]

          [%# AUP %]
          <div class="input">
            <div>[% i18n("Acceptable Use Policy") %]</div>
            <div id="aup">
              <div class="notmobile">
                [% INCLUDE aup_text.html %]
              </div>
              <div class="mobile">
                <input name="aup_signed" type="checkbox" value="on" /> [% i18n("I have read and accept the terms") %]
              </div>
            </div>
            <div class="notmobile"><label><input name="aup_signed" type="checkbox" value="on" /> [% i18n("I accept the terms") %]</label></div>
          </div>

          [%# submit %]
          <div class="input">

            [% IF sponsored_guest_allowed %]
            <div class="note bg">
              <p>
                [% i18n("If you choose to have your access <strong>sponsored</strong>, we will send an email to the Sponsor email you provided with an activation link. The sponsor will need to click on that link and authenticate in order to approve you in.") %]
              [% IF is_preregistration;
                     i18n("You will receive guest credentials by email once approved.");
                 ELSE;
                     i18n("You will be in a waiting area until approved.");
                 END
              %]
              </p>
            </div>
            <input type="submit" class="btn" name="by_sponsor" value="[% i18n("Register through a Sponsor") %]" /><br/>
            [% END %]

            [% IF email_guest_allowed %]
            <div class="note bg">
              [% IF is_preregistration %]
                <p>[% i18n("If you choose to receive your access code <strong>by email</strong>, you will have to click on an activation link sent to your email address. After clicking on the link you will receive guest credentials to use on-site by email") %]</p>
              [% ELSE %]
                <p>[% i18n("If you choose to receive your access code <strong>by email</strong>, you will be given temporary network access for 10 minutes during that time:") %]</p>
                <ul>
                  <li>[% i18n("Login to the email account you referenced and;") %]</li>
                  <li>[% i18n("Click on the link emailed to you to validate network access for the next 24 hours.") %]</li>
                </ul>
              [% END %]

            </div>
            <input type="submit" class="btn" name="by_email" value="[% i18n("Register by Email") %]" /><br/>
            [% END %]

            [% IF sms_guest_allowed and !is_preregistration %]
            <div class="note bg">
              <p>[% i18n("If you choose to receive your access code <strong>by SMS</strong>, you will be able to enter it on the next page.") %]</p>
            </div>
            <input type="submit" class="btn" name="by_sms" value="[% i18n("Register by SMS") %]" />
            [% END %]

          </div>

        </form>


<!-- CUSTOM hide/display fields depending on the registration type -->
<script>
$('guest-signup-method').on('change', '.signup-mode', function(event) {
  console.log(event.target.value);
  if(event.target.value == "sms-mode"){
    $('field-email').hide();
    $('field-mobileprovider').show();
    $('field-phone').show();
  }
  else {
    $('field-mobileprovider').hide();
    $('field-phone').hide();
    $('field-email').show();
  }
});

$('field-mobileprovider').hide();
$('field-phone').hide();
</script>

[% INCLUDE footer.html 
    dont_show_help = is_preregistration
%]
